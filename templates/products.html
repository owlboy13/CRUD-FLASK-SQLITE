<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novo Produto | Sistema Neon</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Exo+2:wght@300;400;500&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/static/style.css">

</head>
<body>
    <div class="container">
        <h1>Adicionar Novo Produto</h1> 
        <form id="productForm" method="POST" action="{{ url_for('new_product') }}">
            <div class="form-group">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" name="nome" required
                    placeholder="Digite o nome do produto"
                    oninput="validateNome(this)">
                <div id="nomeError" class="error-message">
                    O nome deve ter pelo menos 3 caracteres
                </div>
            </div>
            <div class="form-group">
                <label for="preco">Preço:</label>
                <input type="number" id="preco" name="preco" step="0.01" required
                    placeholder="0.00"
                    oninput="validatePreco(this)">
                <div id="precoError" class="error-message">
                    O preço deve ser maior que zero
                </div>
            </div>
            <button type="submit" id="submitButton">Salvar</button>
        </form>

        <div id="successMessage" class="success-message">
            Produto cadastrado com sucesso!
        </div>

        <div class="link-container">
            <p><a href="{{ url_for('index') }}">Ver lista de produtos</a></p>
        </div>
    </div>

    <script>
        // Variáveis para controlar o estado de validação
        let isNomeValid = false;
        let isPrecoValid = false;
        
        // Função para validar o campo nome
        function validateNome(input) {
            const errorElement = document.getElementById('nomeError');
            
            if (input.value.length < 3) {
                input.classList.add('invalid');
                errorElement.style.display = 'block';
                isNomeValid = false;
                updateSubmitButton();
                return false;
            } else {
                input.classList.remove('invalid');
                errorElement.style.display = 'none';
                isNomeValid = true;
                updateSubmitButton();
                return true;
            }
        }
        
        // Função para validar o campo preço
        function validatePreco(input) {
            const errorElement = document.getElementById('precoError');
            const value = parseFloat(input.value);
            
            if (isNaN(value) || value <= 0) {
                input.classList.add('invalid');
                errorElement.style.display = 'block';
                isPrecoValid = false;
                updateSubmitButton();
                return false;
            } else {
                input.classList.remove('invalid');
                errorElement.style.display = 'none';
                isPrecoValid = true;
                updateSubmitButton();
                return true;
            }
        }
        
        // Atualizar estado do botão de envio
        function updateSubmitButton() {
            const submitButton = document.getElementById('submitButton');
            submitButton.disabled = !(isNomeValid && isPrecoValid);
        }
        
        // Validação do formulário antes do envio
        document.getElementById('productForm').addEventListener('submit', function(event) {
            const nomeValid = validateNome(document.getElementById('nome'));
            const precoValid = validatePreco(document.getElementById('preco'));
            
            if (!nomeValid || !precoValid) {
                // Impede o envio se os dados forem inválidos
                event.preventDefault();
                
                // Adicionar efeito de shake nos campos inválidos
                if (!nomeValid) {
                    shakeElement(document.getElementById('nome'));
                }
                if (!precoValid) {
                    shakeElement(document.getElementById('preco'));
                }
            }
            // Se os dados forem válidos, o formulário será enviado normalmente
        });
        
        // Função para animação de shake em elementos inválidos
        function shakeElement(element) {
            element.classList.add('invalid');
            element.animate([
                { transform: 'translateX(0)' },
                { transform: 'translateX(-5px)' },
                { transform: 'translateX(5px)' },
                { transform: 'translateX(-5px)' },
                { transform: 'translateX(5px)' },
                { transform: 'translateX(0)' }
            ], {
                duration: 300,
                iterations: 1
            });
        }
        
        // Validação inicial para desabilitar o botão
        document.addEventListener('DOMContentLoaded', function() {
            updateSubmitButton();
        });
    </script>
</body>
</html>